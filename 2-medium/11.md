## Calculating Available Seats on Flights
 
Calculate the number of seats not yet purchased for each flight. Use three tables: playground.flights (with columns: flight_id, plane_id), playground.planes (with columns: plane_id, number_of_seats), and playground.purchases (with columns: flight_id, seat_no). Each row in purchases is unique for (flight_id, seat_no) pairs. For each flight_id, compute the free_seats as the number of seats not purchased. Order the results by flight_id in ascending order. Ensure consistency in purchases, with no records for non-existing flight_ids or seat_nos.

### These are the tables to query for this question:
#### **playground.flights**
- flight_id int
- plane_id int
#### **playground.planes**
- plane_id int
- number_of_seats int
#### **playground.purchases**
- flight_id int
- seat_no int
### Your answer should include these columns:
- flight_id integer
- free_seats integer

## Answer
```sql
-- my version
WITH A AS (
    SELECT 
        COALESCE(pl.plane_id, f.plane_id) AS plane_id,
        number_of_seats,
        COALESCE(pu.flight_id, f.flight_id) AS flight_id,
        seat_no
    FROM playground.planes pl 
    JOIN playground.flights f
    ON pl.plane_id = f.plane_id
    FULL OUTER JOIN playground.purchases pu
    ON pu.flight_id = f.flight_id
)
SELECT flight_id,
  (number_of_seats - COUNT_IF(seat_no IS NOT NULL))
  AS free_seats 
FROM A
GROUP BY flight_id, number_of_seats
ORDER BY flight_id;


-- GPT version
SELECT 
  f.flight_id,
  pl.number_of_seats - COUNT(pu.seat_no) AS free_seats
FROM playground.flights f
JOIN playground.planes pl 
  ON f.plane_id = pl.plane_id
LEFT JOIN playground.purchases pu 
  ON f.flight_id = pu.flight_id
GROUP BY f.flight_id, pl.number_of_seats
ORDER BY f.flight_id;
```

## Results
| flight_id | free_seats |
|-----------|------------|
| 87        | 2          |
| 100       | 6          |
| 111       | 4          |
| 121       | 7          |
