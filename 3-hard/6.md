## Optimizing Stock of Prime and Non-Prime Items in a Warehouse
 
Given a warehouse with a capacity of 500,000 square feet, Amazon wishes to optimize the number of items stocked, prioritizing prime items. The goal is to fill the warehouse with as many prime items as possible and then supplement the remaining space with non-prime items. However, there are new operational constraints: prime and non-prime items must be stocked in equal quantities, and there must always be non-prime items in stock. Assuming each item occupies the same amount of space, using the table playground.inventory, write a query to determine the maximum number of prime and non-prime items that can be accommodated in the warehouse. The output should list the item_type (prime_eligible or not_prime) followed by the maximum number of item_count that can be stocked, ensuring item counts are whole numbers and adhering to the given constraints and prime_eligible first.

### These are the tables to query for this question:
**playground.inventory**
- item_id int
- item_type string
- item_category string
- square_footage double
### Your answer should include these columns:
- item_type varchar
- item_count integer

## Answer
```sql
WITH A AS (
  SELECT 
    item_type, 
    COUNT(item_type) AS item_type_count,
    SUM(square_footage) AS batch_size
  FROM playground.inventory
  GROUP BY 1
),
B AS (
  SELECT 
    item_type, 
    FLOOR(500000 / batch_size) AS item_count
  FROM A
  WHERE item_type = 'prime_eligible'
), 
C AS (
  SELECT 
    B.item_type AS item_type,
    batch_size, 
    item_count,
    FLOOR(batch_size * item_count) AS batch_volume
  FROM A JOIN B
  ON A.item_type = B.item_type
), 
D AS (
  SELECT 'not_prime' AS item_type,
    (SELECT batch_size FROM A WHERE item_type='not_prime') AS batch_size,
    FLOOR((500000 - batch_volume) / (SELECT batch_size FROM A WHERE item_type='not_prime')) AS item_count,
    (500000 - batch_volume) AS batch_volume
  FROM C
), 
E AS (SELECT * FROM C UNION SELECT * FROM D)
SELECT COALESCE(E.item_type, A.item_type) AS item_type,
  item_count * item_type_count AS item_count
FROM E JOIN A ON E.item_type = A.item_type
ORDER BY 1 DESC
```

## Results
| item_type      | item_count |
|----------------|------------|
| prime_eligible | 9285       |
| not_prime      | 6          |