## Year-on-Year Growth Rate Calculation
 
Using the table playground.dates, write a SQL query to calculate the year-on-year growth rate for the total spend of each product. The output should include the year, product ID, current years spend, previous years spend, and the year-on-year growth percentage, rounded to 2 decimal places, grouped by product ID and sorted by year in ascending order.

## These are the tables to query for this question:
**playground.dates**
- transaction_id int
- product_id int
- spend double
- transaction_date date
### Your answer should include these columns:
- year integer
- product_id integer
- current_year_spend double
- previous_year_spend double
- yoy_rate double

## Answer
```sql
WITH A AS (
  SELECT YEAR(transaction_date) AS year,
    product_id,
    SUM(spend) AS current_year_spend
  FROM playground.dates
  GROUP BY 1, 2
), B AS (
  SELECT *,
    LAG(current_year_spend) 
      OVER (PARTITION BY product_id ORDER BY year)
    AS previous_year_spend
  FROM A
)
SELECT *,
  ROUND((current_year_spend - previous_year_spend) / 
    COALESCE(previous_year_spend, 1.0) * 100, 2)
  AS yoy_rate
FROM B
ORDER BY product_id, year
```

## Results
The checker of this question expects the first row of this table only.

| year | product_id | current_year_spend | previous_year_spend | yoy_rate |
|------|------------|--------------------|---------------------|----------|
| 2019 | 123424     | 1500.6             | NULL                | NULL     |
| 2020 | 123424     | 1000.2             | 1500.6              | -33.35   |
| 2021 | 123424     | 1246.44            | 1000.2              | 24.62    |
| 2022 | 123424     | 2145.32            | 1246.44             | 72.12    |