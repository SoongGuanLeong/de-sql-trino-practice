## Who are the top 10 NBA players by consecutive 20+ point seasons?
 
Using the table bootcamp.nba_player_seasons, find the most consecutive seasons a player has scored 20+ points and find the top 10 players! Make sure to handle ties correctly (you might have more than 10 records!). Sort the output data set by consecutive_seasons descending and player_name ascending!

### hese are the tables to query for this question:
**bootcamp.nba_player_seasons**
- player_name string
- age int
- height string
- weight int
- college string
- country string
- draft_year string
- draft_round string
- draft_number string
- gp double
- pts double
- reb double
- ast double
- netrtg double
- oreb_pct double
- dreb_pct double
- usg_pct double
- ts_pct double
- ast_pct double
- season int
### Your answer should include these columns:
- player_name varchar
- consecutive_seasons integer

## Answer
```sql
WITH A AS (
    SELECT 
        CONCAT(player_name, '-', draft_year, '-', draft_round, '-', draft_number) AS player_id,
        player_name, pts, season
    FROM bootcamp.nba_player_seasons
    WHERE pts >= 20
), B AS (
    SELECT *, 
        CASE WHEN LAG(season) OVER(PARTITION BY player_id ORDER BY season) IS NULL THEN 1
        WHEN season - 1 != LAG(season) OVER(PARTITION BY player_id ORDER BY season) THEN 1 
        ELSE 0 END AS is_new_streak
    FROM A
), C AS (
    SELECT *,
        SUM(is_new_streak) OVER (PARTITION BY player_id ORDER BY season
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS streak_id
    FROM B
    ORDER BY player_id, season
), D AS (
    SELECT player_name, 
        COUNT(1) AS consecutive_seasons 
        FROM C
    GROUP BY player_id, player_name, streak_id
), E AS (
    SELECT *,
        RANK() OVER(ORDER BY consecutive_seasons DESC) AS rnk 
    FROM D
)
SELECT 
    player_name, 
    consecutive_seasons 
FROM E WHERE rnk <= 10
ORDER BY 2 DESC, 1
```

## Results
| player_name       | consecutive_seasons |
|-------------------|---------------------|
| LeBron James      | 20                  |
| Kevin Durant      | 16                  |
| Carmelo Anthony   | 15                  |
| Kobe Bryant       | 14                  |
| Allen Iverson     | 12                  |
| Dirk Nowitzki     | 12                  |
| James Harden      | 11                  |
| Stephen Curry     | 11                  |
| Anthony Davis     | 10                  |
| Damian Lillard    | 10                  |
| DeMar DeRozan     | 10                  |
| Russell Westbrook | 10                  |
| Shaquille O'Neal  | 10                  |
| Vince Carter      | 10                  |