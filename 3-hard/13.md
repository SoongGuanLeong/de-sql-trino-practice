## Determining the Soccer Series Winner
 
From the "scores" table, write a SQL query to determine the series winner based on the following criteria: 1) The team with the most game wins is the winner. 2) If the wins are equal, the team with the better overall goal difference (goals scored - goals conceded) wins. 3) If goal differences are also equal, the winner is the team with more goals scored in away games (when not the host). The "scores" table includes match_id (unique match ID), first_team_score, second_team_score, and match_host (1 or 2, indicating the host team). Return a table with a single column "winner" that contains 1 (for the first team), 2 (for the second team), or 0 if no winner is determined based on these criteria.

### These are the tables to query for this question:
**playground.scores**
- match_id int
- first_team_score int
- second_team_score int
- match_host int
### Your answer should include these columns:
- winner integer

## Answer
```sql
WITH A AS (
    SELECT *,
    CASE WHEN first_team_score > second_team_score THEN 1
      WHEN first_team_score < second_team_score THEN 2 ELSE 0
    END AS team_won
    FROM playground.scores
), 
B AS (
    SELECT team_won, 
        COUNT(team_won) AS team_won_count
    FROM A 
    GROUP BY 1
), 
C AS (
    SELECT 1 AS team, SUM(first_team_score) AS total_team_score FROM A
    UNION
    SELECT 2 AS team, SUM(second_team_score) AS total_team_score FROM A
), 
D AS (
    SELECT team_won AS away_won, 
        COUNT(team_won) AS away_won_count
    FROM A WHERE match_host != team_won
    GROUP BY 1
), 
E AS (
  SELECT 
    COALESCE(B.team_won, C.team, D.away_won) AS team,
    team_won_count, 
    total_team_score, 
    away_won_count
  FROM B FULL OUTER JOIN C ON B.team_won = C.team
  FULL OUTER JOIN D ON B.team_won = D.away_won
)
SELECT 
    CASE 
        WHEN (SELECT team_won_count FROM E WHERE team=1) > (SELECT team_won_count FROM E WHERE team=2) THEN 1
        WHEN (SELECT team_won_count FROM E WHERE team=1) < (SELECT team_won_count FROM E WHERE team=2) THEN 2
        WHEN (SELECT total_team_score FROM E WHERE team=1) > (SELECT total_team_score FROM E WHERE team=2) THEN 1
        WHEN (SELECT total_team_score FROM E WHERE team=1) < (SELECT total_team_score FROM E WHERE team=2) THEN 2
        WHEN (SELECT away_won_count FROM E WHERE team=1) > (SELECT away_won_count FROM E WHERE team=2) THEN 1
        WHEN (SELECT away_won_count FROM E WHERE team=1) < (SELECT away_won_count FROM E WHERE team=2) THEN 2
    ELSE 0 END AS winner;
```

## Results
| winner |
|--------|
| 1      |