## Identify Department for Reduction
 
Select departments that have no more than 5 employees. From these, choose departments based on the descending order of the total salary of its employees. In case of a tie in total salary, prioritize the department with the greater number of employees. If still tied, prioritize by the smallest department id. From the resulting list, eliminate departments in even positions, leaving only those in odd positions for further consideration. The resulting table should contain columns for department name, number of employees, and total salary, sorted as described.

### These are the tables to query for this question:
#### **playground.dept**
- id int
- name string
#### **playground.emp**
- id int
- full_name string
- salary int
- department int
### Your answer should include these columns:
- dep_name varchar
- emp_number integer
- total_salary integer

## Answer
```sql
WITH A AS (
  SELECT 
    COALESCE(d.id, e.department) AS dep_id,
    name AS dep_name,
    e.id AS emp_id,
    full_name,
    salary
  FROM playground.dept d 
  FULL OUTER JOIN playground.emp e
  ON d.id = e.department
), B AS (
SELECT dep_id, dep_name, COUNT(DISTINCT emp_id) AS emp_number,
  SUM(salary) AS total_salary
  FROM A GROUP BY dep_id, dep_name
), C AS (
  SELECT *, 
    ROW_NUMBER() OVER(ORDER BY total_salary DESC, emp_number DESC, dep_id) AS row_num
  FROM B WHERE emp_number <= 5
  ORDER BY total_salary DESC, emp_number DESC, dep_id
)
SELECT dep_name, emp_number, total_salary
FROM C
WHERE row_num % 2 != 0
```

## Results
| dep_name | emp_number | total_salary |
|----------|------------|--------------|
| IT       | 5          | 80           |
| HR       | 2          | 31           |